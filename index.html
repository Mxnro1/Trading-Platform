<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Chart</title>
    <link rel="stylesheet" href="style.css">
    <!-- –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º –≤–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body data-theme="light">
    <div class="container">
        <header>
            <div class="header-main">
                <img src="–∑–∞–≥—Ä—É–∑–∫–∞.png" alt="–õ–æ–≥–æ—Ç–∏–ø" class="header-logo"/>
                <h1>–¢–æ—Ä–≥–æ–≤–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞</h1>
            </div>
            <div class="tabs">
                <button class="tab-button active" data-tab="chart">–ì—Ä–∞—Ñ–∏–∫</button>
                <button class="tab-button" data-tab="monitor">–ú–æ–Ω–∏—Ç–æ—Ä</button>
                <button class="tab-button" data-tab="converter">–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è</button>
            </div>
        </header>
        <main class="content-wrapper">
            <!-- –í–∫–ª–∞–¥–∫–∞ —Å –≥—Ä–∞—Ñ–∏–∫–æ–º -->
            <div class="tab-content active" id="chart-tab">
                <div class="crypto-selector">
                    <select id="cryptoSymbol">
                        <option value="BTCUSDT">Bitcoin (BTC)</option>
                        <option value="TRXUSDT">Tron (TRX)</option>
                        <option value="ETHUSDT">Ethereum (ETH)</option>
                        <option value="BNBUSDT">Binance Coin (BNB)</option>
                        <option value="ADAUSDT">Cardano (ADA)</option>
                        <option value="DOGEUSDT">Dogecoin (DOGE)</option>
                        <option value="XRPUSDT">Ripple (XRP)</option>
                        <option value="SOLUSDT">Solana (SOL)</option>
                        <option value="DOTUSDT">Polkadot (DOT)</option>
                        <option value="MATICUSDT">Polygon (MATIC)</option>
                        <option value="SUIUSDT">Sui (SUI)</option>
                        <option value="AVAXUSDT">Avalanche (AVAX)</option>
                        <option value="LINKUSDT">Chainlink (LINK)</option>
                    </select>
                </div>
                <div class="controls">
                    <div class="interval-buttons">
                        <button class="interval-btn" data-interval="15m">15 –º–∏–Ω</button>
                        <button class="interval-btn" data-interval="30m">30 –º–∏–Ω</button>
                        <button class="interval-btn" data-interval="1h">1 —á–∞—Å</button>
                        <button class="interval-btn" data-interval="1d">1 –¥–µ–Ω—å</button>
                    </div>
                    <div class="date-range">
                        <input type="date" id="startDate">
                        <input type="date" id="endDate">
                    </div>
                    <button id="themeToggle">üåì</button>
                </div>

                <div class="chart-container">
                    <!-- –ì—Ä–∞—Ñ–∏–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–¥–µ—Å—å -->
                </div>

                <div id="candleInfo" class="candle-info">
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–≤–µ—á–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–¥–µ—Å—å -->
                </div>

                <div class="tools-panel">
                    <button id="fibonacciTool">–§–∏–±–æ–Ω–∞—á—á–∏</button>
                    <button id="removeFibonacci">–£–¥–∞–ª–∏—Ç—å –§–∏–±–æ–Ω–∞—á—á–∏</button>
                    <button id="clearChart">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
                    <button id="exportCSV">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
                </div>

                <div class="grid-bot-calculator">
                    <h3>–†–∞—Å—á–µ—Ç –ì—Ä–∏–¥-–ë–æ—Ç–∞</h3>
                    <div class="grid-inputs">
                        <div class="form-group">
                            <label for="buyPrice">–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏</label>
                            <input type="number" id="buyPrice" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="sellPrice">–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏</label>
                            <input type="number" id="sellPrice" step="0.01">
                        </div>
                        <button id="calculateGrid">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
                    </div>
                    <div id="gridResult" class="grid-result"></div>
                    <div id="gridTradeLog" class="grid-trade-log">
                        <h4>–õ–æ–≥ —Å–¥–µ–ª–æ–∫</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>–í—Ä–µ–º—è</th>
                                    <th>–¢–∏–ø</th>
                                    <th>–¶–µ–Ω–∞</th>
                                </tr>
                            </thead>
                            <tbody id="gridTradeLogBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∞ -->
            <div class="tab-content" id="monitor-tab">
                <div class="monitor-container">
                    <div class="monitor-header">
                        <h2>–ú–æ–Ω–∏—Ç–æ—Ä –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç</h2>
                        <div class="monitor-controls">
                            <button id="refreshMonitor">–û–±–Ω–æ–≤–∏—Ç—å</button>
                            <select id="monitorInterval">
                                <option value="1m">1 –º–∏–Ω—É—Ç–∞</option>
                                <option value="5m">5 –º–∏–Ω—É—Ç</option>
                                <option value="15m">15 –º–∏–Ω—É—Ç</option>
                                <option value="1h">1 —á–∞—Å</option>
                            </select>
                        </div>
                    </div>
                    <div class="monitor-grid">
                        <table id="monitorTable">
                            <thead>
                                <tr>
                                    <th>–ü–∞—Ä–∞</th>
                                    <th>–¶–µ–Ω–∞</th>
                                    <th>–ò–∑–º–µ–Ω–µ–Ω–∏–µ (24—á)</th>
                                    <th>–û–±—ä–µ–º (24—á)</th>
                                    <th>–ú–∞–∫—Å. —Ü–µ–Ω–∞</th>
                                    <th>–ú–∏–Ω. —Ü–µ–Ω–∞</th>
                                    <th>RSI</th>
                                    <th>–¢—Ä–µ–Ω–¥</th>
                                </tr>
                            </thead>
                            <tbody id="monitorTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä–∞ -->
            <div class="tab-content" id="converter-tab">
              <div id="crypto-converter">
                <h3>–ö—Ä–∏–ø—Ç–æ-–∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä</h3>
                <input type="number" id="cc-amount" placeholder="–°—É–º–º–∞" value="1" />
                <select id="cc-from"></select>
                <button id="cc-swap">‚áÑ</button>
                <select id="cc-to"></select>
                <button id="cc-convert">–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                <button id="cc-auto">–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</button>
                <h3 id="cc-result">–†–µ–∑—É–ª—å—Ç–∞—Ç: ...</h3>
                <div class="converter-actions">
                  <button id="cc-export">–≠–∫—Å–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏</button>
                  <button id="cc-clear">–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
                </div>
                <div id="cc-history"><strong>–ò—Å—Ç–æ—Ä–∏—è:</strong></div>
              </div>
            </div>
        </main>
    </div>

    <!-- –ó–∞—Ç–µ–º –Ω–∞—à–∏ —Å–∫—Ä–∏–ø—Ç—ã -->
    <script src="arbitrage.js"></script>
    <script src="script.js"></script>
    <script src="monitor.js"></script>
    <script>
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è input[type='date']
    document.addEventListener('DOMContentLoaded', function() {
        var today = new Date();
        var yyyy = today.getFullYear();
        var mm = String(today.getMonth() + 1).padStart(2, '0');
        var dd = String(today.getDate()).padStart(2, '0');
        var formatted = yyyy + '-' + mm + '-' + dd;
        var start = document.getElementById('startDate');
        var end = document.getElementById('endDate');
        if (start) start.value = formatted;
        if (end) end.value = formatted;
    });

    // --- –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫ ---
    document.addEventListener('DOMContentLoaded', () => {
        const tabs = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Deactivate all tabs and content
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));

                // Activate the clicked tab and its content
                tab.classList.add('active');
                const activeTabContent = document.getElementById(tab.dataset.tab + '-tab');
                if (activeTabContent) {
                    activeTabContent.classList.add('active');
                }
            });
        });
    });

    // --- –õ–æ–≥–∏–∫–∞ –∫—Ä–∏–ø—Ç–æ-–∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–∞ ---
    (function() {
        if (!document.getElementById('crypto-converter')) return;

        const symbols = ["BTC", "ETH", "XRP", "BNB", "SOL", "ADA", "SUI", "LINK", "XLM", "AVAX", "TON", "LTC", "DOT", "USDT", "USDC", "RUB", "USD", "EUR"];
        const fiatSymbols = ["RUB", "USD", "EUR"];

        const amountInput = document.getElementById('cc-amount');
        const fromSelect = document.getElementById('cc-from');
        const toSelect = document.getElementById('cc-to');
        const swapBtn = document.getElementById('cc-swap');
        const convertBtn = document.getElementById('cc-convert');
        const autoBtn = document.getElementById('cc-auto');
        const resultEl = document.getElementById('cc-result');
        const exportBtn = document.getElementById('cc-export');
        const clearBtn = document.getElementById('cc-clear');
        const historyEl = document.getElementById('cc-history');

        let autoUpdateInterval = null;

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
        function init() {
            symbols.forEach(sym => {
                fromSelect.add(new Option(sym, sym));
                toSelect.add(new Option(sym, sym));
            });
            fromSelect.value = "BTC";
            toSelect.value = "USDT";

            renderHistory();
            convert();

            // Event Listeners
            convertBtn.addEventListener('click', convert);
            swapBtn.addEventListener('click', swapCurrencies);
            autoBtn.addEventListener('click', toggleAutoUpdate);
            clearBtn.addEventListener('click', clearHistory);
            exportBtn.addEventListener('click', exportHistory);
        }

        // --- –õ–æ–≥–∏–∫–∞ API –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ ---
        async function getPrice(from, to) {
            const symbol = from + to;
            try {
                const res = await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${symbol}`);
                if (!res.ok) return null;
                const json = await res.json();
                return parseFloat(json.price);
            } catch (e) {
                return null;
            }
        }

        async function convert() {
            const amount = parseFloat(amountInput.value) || 1;
            const from = fromSelect.value;
            const to = toSelect.value;

            if (from === to) {
                resultEl.textContent = `–†–µ–∑—É–ª—å—Ç–∞—Ç: ${amount} ${from}`;
                return;
            }

            resultEl.textContent = '–ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–∞...';

            try {
                let rate = await getPrice(from, to);
                let result;

                if (rate) {
                    result = amount * rate;
                } else {
                    const inverseRate = await getPrice(to, from);
                    if (inverseRate) {
                        result = amount / inverseRate;
                    } else {
                        throw new Error('–ü–∞—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                    }
                }

                resultEl.textContent = `–†–µ–∑—É–ª—å—Ç–∞—Ç: ${result.toFixed(6)} ${to}`;
                saveHistory(`${amount} ${from} = ${result.toFixed(6)} ${to}`);
            } catch (e) {
                resultEl.textContent = '–û—à–∏–±–∫–∞: –ø–∞—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.';
            }
        }

        function swapCurrencies() {
            [fromSelect.value, toSelect.value] = [toSelect.value, fromSelect.value];
            convert();
        }

        function toggleAutoUpdate() {
            if (autoUpdateInterval) {
                clearInterval(autoUpdateInterval);
                autoUpdateInterval = null;
                autoBtn.textContent = '–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ';
                autoBtn.style.backgroundColor = 'var(--primary-color)';
            } else {
                autoUpdateInterval = setInterval(convert, 10000);
                autoBtn.textContent = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å';
                autoBtn.style.backgroundColor = '#f44336'; // Crimson-like red
            }
        }

        // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π ---
        function getHistory() {
            return JSON.parse(localStorage.getItem('ccHistory') || '[]');
        }

        function saveHistory(entry) {
            let history = getHistory();
            history.unshift(entry);
            if (history.length > 20) {
                history = history.slice(0, 20);
            }
            localStorage.setItem('ccHistory', JSON.stringify(history));
            renderHistory();
        }
        
        function renderHistory() {
            const history = getHistory();
            historyEl.innerHTML = '<strong>–ò—Å—Ç–æ—Ä–∏—è:</strong><br/>' + history.map(h => `<div>${h}</div>`).join('');
        }

        function clearHistory() {
            localStorage.removeItem('ccHistory');
            renderHistory();
        }

        function exportHistory() {
            const history = getHistory().join('\\n');
            const blob = new Blob([history], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'conversion_history.txt';
            link.click();
            URL.revokeObjectURL(link.href);
        }

        init();
    })();
    </script>
</body>
</html> 